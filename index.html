<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>社内イベント クイズラリー</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --header-bg-color:#000; --button-bg-color:#f64850; --hint-button-bg-color:#888; --reset-button-bg-color:#888;
      --body-bg-color:#eef3f5; --card-bg-color:#fff; --text-color:#333; --white:#fff; --light-gray:#e9ecef;
      --success-color:#28a745; --error-color:#dc3545;
    }
    body {
      margin:0; font-family:'Noto Sans JP',sans-serif; background:var(--body-bg-color); color:var(--text-color);
      display:flex; justify-content:center; align-items:center; min-height:100vh;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container { width:100%; max-width:500px; height:90vh; max-height:800px; background:var(--card-bg-color);
      border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,.1); padding:24px; margin:20px; box-sizing:border-box;
      display:flex; flex-direction:column; }
    .hidden { display:none; }
    #initial-screen { text-align:center; }
    #initial-screen .logo h1 { color:#000; font-weight:700; margin:0 0 24px; }
    #team-name-input { width:100%; padding:12px; border:1px solid var(--light-gray); border-radius:8px; font-size:16px; box-sizing:border-box; margin-bottom:16px; }
    #start-button { width:100%; padding:14px; font-size:18px; font-weight:700; color:#fff; background:var(--button-bg-color); border:none; border-radius:8px; cursor:pointer; transition:filter .3s; }
    #start-button:hover { filter:brightness(.9); }
    .reset-button { width:100%; padding:10px; margin-top:12px; font-size:14px; font-weight:700; color:#fff; background:var(--reset-button-bg-color); border:none; border-radius:8px; cursor:pointer; transition:filter .3s; }
    .reset-button:hover { filter:brightness(.9); }
    #quiz-screen { display:flex; flex-direction:column; height:100%; }
    .quiz-header { display:flex; justify-content:space-between; align-items:center; background:var(--header-bg-color); color:#fff; padding:12px 16px; border-radius:8px; margin-bottom:16px; flex-shrink:0; }
    .quiz-header strong { font-weight:400; font-size:.9em; }
    #team-name-output, #score-output, #hint-count-output, #progress-output { font-weight:700; font-size:1.1em; }
    #score-display, #hint-count-display, #progress-display { margin-top:4px; }
    #quiz-container { overflow-y:auto; padding-right:10px; flex-grow:1; }
    .quiz-card { background:#fff; border:1px solid var(--light-gray); padding:16px; border-radius:8px; margin-bottom:16px; border-left:5px solid var(--light-gray); transition:all .3s; }
    .quiz-card.correct { border-left-color:var(--success-color); background:#f0fff4; }
    .quiz-card h2 { margin:0 0 16px; color:var(--text-color); }
    .quiz-card input { width:100%; padding:10px; border:1px solid var(--light-gray); border-radius:8px; font-size:16px; box-sizing:border-box; margin-bottom:12px; }
    .quiz-card button { width:100%; padding:12px; font-size:16px; font-weight:700; color:#fff; border:none; border-radius:8px; cursor:pointer; transition:filter .3s, background-color .3s; margin-bottom:10px; }
    .answer-button { background:var(--button-bg-color); }
    .answer-button:hover { filter:brightness(.9); }
    .hint-button { background:var(--hint-button-bg-color); font-size:14px; padding:10px; }
    .hint-button:hover { filter:brightness(.9); }
    .result { margin-top:12px; margin-bottom:0; font-weight:700; text-align:center; line-height:1.5; }
    .hint-text { background:#f0f7ff; border:1px solid #cce5ff; border-radius:4px; padding:10px; margin:8px 0 0 0; color:#004085; font-weight:500; }
  </style>
</head>
<body>
  <div class="container">
    <div id="initial-screen">
      <header class="logo"><h1>EVENT QUIZ RALLY</h1></header>
      <main>
        <p class="description">ようこそ！<br>チーム名を入力してクイズを始めよう！</p>
        <input type="text" id="team-name-input" placeholder="チーム名を入力">
        <button id="start-button">クイズをはじめる</button>
        <button id="reset-button-top" class="reset-button">記録をリセット</button>
      </main>
    </div>
    <div id="quiz-screen" class="hidden">
      <header class="quiz-header">
        <div id="team-display"><strong>TEAM:</strong><br><span id="team-name-output"></span></div>
        <div>
          <div id="score-display"><strong>SCORE:</strong> <span id="score-output">0</span> pt</div>
          <div id="progress-display"><strong>PROGRESS:</strong> <span id="progress-output">0 / 59</span></div>
          <div id="hint-count-display"><strong>HINTS USED:</strong> <span id="hint-count-output">0</span></div>
        </div>
      </header>
      <main id="quiz-container"></main>
      <button id="reset-button-quiz" class="reset-button">記録をリセット</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const quizzes = [

    {
        "id": 0,
        "answer": "2019",
        "hint": "令和元年です",
        "hintCost": 0,
        "points": 0
    },
    {
        "id": 1,
        "answer": "衝動",
        "hint": "1年前のOh!会で流れていた曲",
        "hintCost": 8,
        "points": 25
    },
    {
        "id": 2,
        "answer": "有楽町",
        "hint": "緑の線は山手線を表している",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 3,
        "answer": "35",
        "hint": "スタッフエリアで定規を借りることができます。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 4,
        "answer": "手続き歯型",
        "hint": "誤りは2つです。2行目と3行目に1つずつあります。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 5,
        "answer": "LINEお問い合わせ",
        "hint": "誤りは2つです。1行目に2つあります。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 6,
        "answer": "SmileGoメンバー",
        "hint": "誤りは2つです。1行目と2行目にあります。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 7,
        "answer": "アップルストアが近くにあるから",
        "hint": "西野さんはApple製品が大好きです。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 8,
        "answer": [
            "かぐらざか",
            "神楽坂"
        ],
        "hint": "3つのうち1つは「後戻り」",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 9,
        "answer": "革命的な歯科プロダクトを日本中へ",
        "hint": "どうやらアルファベットは文字化けしていないようだ。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 10,
        "answer": "マイク",
        "hint": "",
        "hintCost": 0,
        "points": 20
    },
    {
        "id": 11,
        "answer": "バーナー",
        "hint": "「リムーバー」が1kgだとすると「チューイ―」は0.5kgだ。この調子で考えよう。",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 12,
        "answer": "D",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 13,
        "answer": "咬合",
        "hint": "答えの意味：上下の歯が接する状態のこと",
        "hintCost": 5,
        "points": 10
    },
    {
        "id": 14,
        "answer": "価値",
        "hint": "3つのうち1つは「口腔」",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 15,
        "answer": "DIAGNOSE",
        "hint": "図が示しているのは「Angle III 級」だ。下の歯が\"正常な位置\"よりも前に出てしまっているぞ。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 16,
        "answer": "DENTAL",
        "hint": "図が示しているのは「Angle II 級」下の歯が\"正常な位置\"よりも後ろに出てしまっているぞ。",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 17,
        "answer": "C",
        "hint": "データだけでは現在の情報しか読み取ることはできない",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 18,
        "answer": "利きマウスピースに成功した",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 19,
        "answer": "神経衰弱クリア",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 20,
        "answer": "第一大臼歯",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 21,
        "answer": "耳下腺",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 22,
        "answer": "アルジネート",
        "hint": "答えはカタカナ6文字だ",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 23,
        "answer": "C",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 24,
        "answer": "35",
        "hint": "数字は歯式を表しているぞ",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 25,
        "answer": "1",
        "hint": "数字は歯式を表しているぞ",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 26,
        "answer": "121",
        "hint": "全ツールは以下の通り「VS code」「notion」「Java」「backlog」「ec2」「mysql」「chatgpt」「github」「docker」「Go」「asana」",
        "hintCost": 7,
        "points": 15
    },
    {
        "id": 27,
        "answer": "最高の組織",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 28,
        "answer": "かわいいが全て",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 29,
        "answer": "しりとり名人",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 30,
        "answer": "メガネだいすき",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 31,
        "answer": "びっくり",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 32,
        "answer": "大爆笑",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 33,
        "answer": "おたからはっけん",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 34,
        "answer": "松尾芭蕉",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 35,
        "answer": "ねつい",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 36,
        "answer": "君は小説家",
        "hint": "",
        "hintCost": 0,
        "points": 15
    },
    {
        "id": 37,
        "answer": "駅",
        "hint": "",
        "hintCost": 0,
        "points": 20
    },
    {
        "id": 38,
        "answer": "きみ",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 39,
        "answer": "フリック",
        "hint": "右の図形を、あなたが今持っているものの中で見たことはないだろうか？",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 40,
        "answer": "かくしあじ",
        "hint": "「あまい」「からい」「しょっぱい」「にがい」「すっぱい」の5つだ",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 41,
        "answer": [
            "すとあ",
            "ストア"
        ],
        "hint": "どこかに見落としている図形がないだろうか？",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 42,
        "answer": "けいぞくりつ",
        "hint": "",
        "hintCost": 0,
        "points": 10
    },
    {
        "id": 43,
        "answer": [
            "入口",
            "いりぐち"
        ],
        "hint": "問題文は「ぞう」「きんか」「らいと」だ",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 44,
        "answer": [
            "奥歯",
            "おくば"
        ],
        "hint": "数字は50音表の列を表している。向きは..？",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 45,
        "answer": [
            "出席",
            "しゅっせき"
        ],
        "hint": "白い四角にひらがなが入る。黒い四角にはひらがなは入らないぞ",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 46,
        "answer": "癖",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 47,
        "answer": "懲戒解雇",
        "hint": "ルール説明の時に司会の人が説明していたぞ",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 48,
        "answer": "オーナーズビル",
        "hint": "神楽坂のオフィスに出社する人はぜひとも答えてもらいたい問題だ！",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 49,
        "answer": "カワクーナ",
        "hint": "神楽坂のオフィスに出社する人はぜひとも答えてもらいたい問題だ！",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 50,
        "answer": "おどろき",
        "hint": "4つのピースをうまく解答用紙に当てはめよう。矢印の先にある4文字が答えだ。",
        "hintCost": 7,
        "points": 20
    },
    {
        "id": 51,
        "answer": "未来の歯科体験を生み出す",
        "hint": "Oh my teethの一員なら知っていてほしい文章だ",
        "hintCost": 4,
        "points": 10
    },
    {
        "id": 52,
        "answer": "オンライン",
        "hint": "それぞれの歯の別名を考えてみよう",
        "hintCost": 5,
        "points": 15
    },
    {
        "id": 53,
        "answer": "THEME",
        "hint": "他の問題にはない文字がこの問題用紙にはないだろうか？",
        "hintCost": 2,
        "points": 5
    },
    {
        "id": 54,
        "answer": "西野さん確保",
        "hint": "",
        "hintCost": 0,
        "points": 20
    },
    {
        "id": 55,
        "answer": "ここから大逆転",
        "hint": "",
        "hintCost": 0,
        "points": 15
    },
    {
        "id": 56,
        "answer": "運命の相手",
        "hint": "",
        "hintCost": 0,
        "points": 30
    },
    {
        "id": 57,
        "answer": "1006",
        "hint": "",
        "hintCost": 0,
        "points": 5
    },
    {
        "id": 58,
        "answer": "1006",
        "hint": "",
        "hintCost": 0,
        "points": -5
    }

]

      const POINTS_PER_CORRECT = 10;
      const ONE_SHOT_IDS = [12, 17, 23];

      const initialScreen = document.getElementById('initial-screen');
      const quizScreen = document.getElementById('quiz-screen');
      const startButton = document.getElementById('start-button');
      const resetButtonTop = document.getElementById('reset-button-top');
      const resetButtonQuiz = document.getElementById('reset-button-quiz');
      const teamNameInput = document.getElementById('team-name-input');
      const teamNameOutput = document.getElementById('team-name-output');
      const scoreOutput = document.getElementById('score-output');
      const hintCountOutput = document.getElementById('hint-count-output');
      const progressOutput = document.getElementById('progress-output');
      const quizContainer = document.getElementById('quiz-container');

      let teamName = '';
      let score = 0;
      let correctAnswers = [];
      let revealedHints = [];
      let oneShotLocked = [];

      startButton.addEventListener('click', startGame);
      resetButtonTop.addEventListener('click', resetGame);
      resetButtonQuiz.addEventListener('click', resetGame);

      quizContainer.addEventListener('click', (event) => {
        if (event.target.classList.contains('answer-button')) {
          handleAnswerSubmit(event);
        }
        if (event.target.classList.contains('hint-button')) {
          handleHintRequest(event);
        }
      });

      loadState();

      function startGame() {
        const name = teamNameInput.value.trim();
        if (name === '') {
          alert('チーム名を入力してください。');
          return;
        }
        teamName = name;
        saveState();
        initialScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        renderQuizScreen();
      }

      function resetGame() {
        const isConfirmed = confirm('すべての記録（チーム名、スコア、ヒント）がリセットされます。よろしいですか？');
        if (isConfirmed) {
          localStorage.removeItem('quizRallyState');
          alert('記録をリセットしました。');
          location.reload();
        }
      }

      function renderQuizScreen() {
        teamNameOutput.textContent = teamName;
        scoreOutput.textContent = score;
        hintCountOutput.textContent = revealedHints.length;
        progressOutput.textContent = `${correctAnswers.length} / ${quizzes.length}`;

        quizContainer.innerHTML = '';
        quizzes.forEach(quiz => {
          const isCorrect = correctAnswers.includes(quiz.id);
          const isLocked = oneShotLocked.includes(quiz.id) && !isCorrect;
          const isHintRevealed = revealedHints.includes(quiz.id);

          const card = document.createElement('div');
          card.className = 'quiz-card';
          card.dataset.quizId = quiz.id;

          if (isCorrect) card.classList.add('correct');

          // Display answer (string or array). Default to join with " / " when array.
          const answerText = Array.isArray(quiz.answer) ? quiz.answer.join(' / ') : quiz.answer;
          const resultMessage = isCorrect
            ? `正解！ (+${quiz.points}pt)<br>答え: ${answerText}`
            : (isLocked ? '不正解！解答権は1回のみです（終了）' : '');

          card.innerHTML = `
            <h2>Q${quiz.id}</h2>
            <input type='text' placeholder='答えを入力' ${isCorrect || isLocked ? 'disabled' : ''}>
            <button class="answer-button" ${isCorrect || isLocked ? "style='display:none;'" : ''}>回答する</button>
            <button class="hint-button" ${isCorrect || isHintRevealed || quiz.hintCost === 0 || isLocked ? "style='display:none;'" : ''}>ヒントを見る (${quiz.hintCost}pt消費)</button>
            <p class="hint-text ${isHintRevealed ? '' : 'hidden'}">${quiz.hint}</p>
            <p class='result ${isCorrect ? 'correct-msg' : ''}'>${resultMessage}</p>
          `;
          quizContainer.appendChild(card);
        });
      }

      function handleAnswerSubmit(event) {
        const card = event.target.closest('.quiz-card');
        const quizId = parseInt(card.dataset.quizId, 10);
        const input = card.querySelector('input');

        if (oneShotLocked.includes(quizId)) {
          alert('この問題の解答権は1回のみです。');
          return;
        }

        const userAnswer = input.value.trim();
        if (userAnswer === '') {
          alert('答えを入力してください。');
          return;
        }
        const quiz = quizzes.find(q => q.id === quizId);

        const norm = (s) => (typeof s === 'string' ? s.toLowerCase().normalize('NFKC') : '');
        const acceptable = Array.isArray(quiz.answer) ? quiz.answer : [quiz.answer];
        const isAnswerCorrect = acceptable.some(a => norm(userAnswer) === norm(a));

        if (isAnswerCorrect) {
          if (!correctAnswers.includes(quizId)) {
            score += quiz.points;
            correctAnswers.push(quizId);
            saveState();
            renderQuizScreen();
          }
        } else {
          const isOneShot = ONE_SHOT_IDS.includes(quizId);
          if (isOneShot) {
            oneShotLocked.push(quizId);
            saveState();
            renderQuizScreen();
          } else {
            card.classList.add('incorrect');
            card.querySelector('.result').textContent = '残念！不正解';
            setTimeout(() => {
              card.classList.remove('incorrect');
              card.querySelector('.result').textContent = '';
            }, 2000);
          }
        }
      }

      function handleHintRequest(event) {
        const card = event.target.closest('.quiz-card');
        const quizId = parseInt(card.dataset.quizId, 10);
        const quiz = quizzes.find(q => q.id === quizId);

        const isConfirmed = confirm(`${quiz.hintCost}ptを消費してヒントを見ますか？`);
        if (!isConfirmed) return;

        if (score < quiz.hintCost) {
          alert('ポイントが足りません。');
          return;
        }

        score -= quiz.hintCost;
        revealedHints.push(quizId);

        saveState();
        renderQuizScreen();
      }

      function saveState() {
        const state = { teamName, score, correctAnswers, revealedHints, oneShotLocked };
        localStorage.setItem('quizRallyState', JSON.stringify(state));
      }

      function loadState() {
        const savedState = localStorage.getItem('quizRallyState');
        if (savedState) {
          const state = JSON.parse(savedState);
          teamName = state.teamName;
          score = state.score;
          correctAnswers = state.correctAnswers;
          revealedHints = state.revealedHints || [];
          oneShotLocked = state.oneShotLocked || [];

          if (teamName) {
            initialScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            teamNameInput.value = teamName;
            renderQuizScreen();
          }
        }
      }
    });
  </script>
</body>
</html>
